{include file="layouts/__header" /}
    <link rel="stylesheet" type="text/css" href="__CSS__/conferenceList.css">
    <title></title>
</head>
<body>
    <header>
        <a href="javascript:history.back(-1)"><i></i></a>
        <h1></h1>
    </header>
    <section>
        <ul class="table clearfix">
            <li>主持人<input type="text"></li>
            <li>应到会人数<input type="text"></li>
            <li>记录人<input type="text"></li>
            <li>实到会人数<input type="text"></li>
        </ul>
        <ul class="items clearfix">
            <li class="time"><a><i></i>会议时间<span>2019年4月16日10点00分</span></a></li>
            <li class="address"><a><i></i>浙江省温州市瓯海区</a></li>
            <li class="detailed jt_r"><a><i></i><input type="text" placeholder="请输入详细地址"></a></li>
        </ul>
        <div class="record">
            <h1>会议记录</h1>
            <textarea placeholder="输入会议内容" class="content"></textarea>
        </div>
        <div class="vote">
            <h1>本次会议如有表决请记录</h1>
            <i class="add"></i>
            <p>本次会议应到正式党员<input type="text">人，实到<input type="text">人</p>
            <div class="list">
                <ul class="voteList clearfix">
                    <li>表决事项一：<input type="text" class="title"></li>
                    <li>
                        <span>同意票数<input type="text" class="agree"></span>
                        <span>不同意票数<input type="text" class="disagree"></span>
                        <span>弃权票数<input type="text" class="waiver"></span>
                    </li>
                    <li>表决结果：<input type="text" placeholder="通过或不通过" class="voting"></li>
                </ul>
            </div>
        </div>
        <a class="btn">记录完毕</a>
    </section>
</body>
<script src="__JS__/jquery-1.8.3.min.js"></script>
<script>

    ini();
    //初始方法
    function ini(){
        $(".btn").click(function(){
            var items=attr();
            //console.log(items);//返回所有数据
            $.ajax({
                type: 'POST',
                url: '__URL__/index/',
                data: items,
                dataType: 'json',
                timeout: 10000,
                success: function(data){
                    console.log(data);
                    $(".btn").hide();
                },
                error: function(xhr, type){
                    console.log("失败");
                    $(".btn").show();
                }
            });
        });
        //title名
        var type=getQueryString("list");
        if(type=="1"){
            $("title").text("村（社区）支部委员会会议");
            $("header h1").text("村（社区）支部委员会会议");
        }else if(type=="2"){
            $("title").text("村（社区）党员活动（会议）");
            $("header h1").text("村（社区）党员活动（会议）");
        }else if(type=="3"){
            $("title").text("村（社区）支委员和村委员联席会议");
            $("header h1").text("村（社区）支委员和村委员联席会议");
        }else if(type=="4"){
            $("title").text("村（居）民代表会议");
            $("header h1").text("村（居）民代表会议");
        }

        $('.add').click(function(){
            var l=$(".list .voteList").length;
            if(l<10){
                var num=["一","二","三","四","五","六","七","八","九","十"];
                var item='<ul class="voteList clearfix">'
                        +'<li>表决事项'+num[l]+'：<input type="text" class="title"></li>'
                        +'<li>'
                        +'<span>同意票数<input type="text" class="agree"></span>'
                        +'<span>不同意票数<input type="text" class="disagree"></span>'
                        +'<span>弃权票数<input type="text" class="waiver"></span>'
                        +'</li>'
                        +'<li>表决结果：<input type="text" placeholder="通过或不通过" class="voting"></li>'
                        +'</ul>';
                $(".list").append(item);
            }else{
                alert("表决事项最多十条");
            } 
        });
    }
    function attr(){
        var item=[{}];
        var host=$(".table li").eq(0).children("input").val(),
            allNum=$(".table li").eq(1).children("input").val(),
            noteTaker=$(".table li").eq(2).children("input").val(),
            actualNum=$(".table li").eq(3).children("input").val(),
            address=$(".address a").text(),
            address=$(".content").val(),
            allPartyNum=$(".vote>p>input").eq(0).val(),
            actualPartyNum=$(".vote>p>input").eq(1).val();
        item=[{
            host:host,
            allNum:allNum,
            noteTaker:noteTaker,
            actualNum:actualNum,
            address:address,
            address:address,
            allPartyNum:allPartyNum,
            actualPartyNum:actualPartyNum
        }];
        var voteList=[{}];
        var l=$(".voteList").length;
        for(var i=0;i<l;i++){
            var title=$(".voteList").eq(i).find(".title").val(),
                agreeNum=$(".voteList").eq(i).find(".agree").val(),
                disagreeNum=$(".voteList").eq(i).find(".disagree").val(),
                waiverNum=$(".voteList").eq(i).find(".waiver").val(),
                voting=$(".voteList").eq(i).find(".voting").val();
            voteList=[{
                title:title,
                agreeNum:agreeNum,
                disagreeNum:disagreeNum,
                waiverNum:waiverNum,
                voting:voting
            }]
            item.push(voteList);
        }
        return item;
    }
    //获取url参数
    //console.log(getQueryString("type"));
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var reg_rewrite = new RegExp("(^|/)" + name + "/([^/]*)(/|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        var q = window.location.pathname.substr(1).match(reg_rewrite);
        if(r != null){
            return unescape(r[2]);
        }else if(q != null){
            return unescape(q[2]);
        }else{
            return null;
        }
    }
</script>
</html>